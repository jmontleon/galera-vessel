version: "2"
services:
{% for i in range (1,containers+1) %}
  mariadb-{{ i }}:
    image: centos:7
    entrypoint: [/usr/bin/entrypoint.sh]
    working_dir: /
    user: mysql
{% if i == 1 and not heal_node %}
    command: [/usr/bin/dumb-init, mysqld_safe, --wsrep-new-cluster]
{% elif i == heal_node %}
    command: [/usr/bin/dumb-init, mysqld_safe, --wsrep-new-cluster]
{% else %}
    command: [/usr/bin/dumb-init, mysqld_safe]
{% endif %}
    environment:
    - MARIADB_DATABASE=mysql
    - MARIADB_USERNAME=admin
    - MARIADB_PASSWORD=foo
    - MARIADB_ROOT_PASSWORD=sesame
    expose:
    - 3306
    - 4567
    - 4444
    - 4568
    volumes:
    - mariadb{{ i }}-data:/var/lib/mysql:rw
    options:
      openshift:
        persistent_volume_claims:
        - volume_name: mariadb{{ i }}-data
          claim_name: mariadb{{ i }}-data
          access_modes:
          - ReadWriteOnce
    {% if i != 1 %}depends_on: [mariadb-1]{% endif %}

{% endfor %}
volumes:
{% for i in range (1,containers+1) %}
  mariadb{{ i }}-data: {}
{% endfor %}
